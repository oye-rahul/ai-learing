# Netlify Configuration for Learnixo (Optimized)

[build]
  # Specify the directory to change to before starting a build
  base = "frontend"
  
  # Specify the directory that contains the deploy-ready assets (relative to base)
  publish = "build"
  
  # The command that builds the project
  # CI=false: Ensures ESLint warnings don't fail the build in CI environments
  # GENERATE_SOURCEMAP=false: Saves memory and speeds up build time
  command = "CI=false GENERATE_SOURCEMAP=false npm run build"

[build.environment]
  # Explicitly set Node version to match your development environment
  NODE_VERSION = "18"
  # Use legacy peer deps to avoid potential installation conflicts in CI
  NPM_FLAGS = "--legacy-peer-deps"

# API Proxy to your Vercel Backend
# This allows the frontend to call /api/* and have it proxied to the backend
[[redirects]]
  from = "/api/*"
  to = "https://ai-learing-n9mb.vercel.app/api/:splat"
  status = 200
  force = true

# Redirect all other requests to index.html for React Router (SPA support)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Security and Performance Headers
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"
    Content-Security-Policy = "upgrade-insecure-requests"

# Cache static assets for better performance
[[headers]]
  for = "/static/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Do not cache service worker to ensure users get the latest version
[[headers]]
  for = "/service-worker.js"
  [headers.values]
    Cache-Control = "no-cache"
